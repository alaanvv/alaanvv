local ascii = {
  neovim = {
    [[                               __                ]],
    [[  ___     ___    ___   __  __ /\_\    ___ ___    ]],
    [[ / _ `\  / __`\ / __`\/\ \/\ \\/\ \  / __` __`\  ]],
    [[/\ \/\ \/\  __//\ \_\ \ \ \_/ |\ \ \/\ \/\ \/\ \ ]],
    [[\ \_\ \_\ \____\ \____/\ \___/  \ \_\ \_\ \_\ \_\]],
    [[ \/_/\/_/\/____/\/___/  \/__/    \/_/\/_/\/_/\/_/]],
  },

  bonfire = {
    '⠀⠀⠀⠀⠀⠐⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀',
    '⠀⠀⠀⠀⠀⠀⠈⣾⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀',
    '⠀⠀⠀⠀⠀⠀⠀⢸⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀',
    '⠀⠀⠀⠀⠀⠀⠀⣈⣼⣄⣠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀',
    '⠀⠀⠀⠀⠀⠀⠉⠑⢷⣿⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀',
    '⠀⠀⠀⠀⠀⠀⠀⠀⣼⣐⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀',
    '⠀⠀⠀⠀⠀⠀⠀⠀⠘⡚⢧⠀⠀⠀⢠⠀⠀⠀⠀⠀⠀⠀⠀⠀',
    '⠀⠀⠀⠀⠀⠀⠀⠀⠀⢃⢿⡇⠀⠀⡾⡀⠀⠀⠀⠀⠀⠀⠀⠀',
    '⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⠸⣇⠀⠀⠡⣰⠀⠀⠀⠀⠀⠀⠀⠀',
    '⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠇⣿⠀⢠⣄⢿⠇⠀⠀⠀⠀⠀⠀⠀',
    '⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⢸⡇⠜⣭⢸⡀⠀⠀⠀⠀⠀⠀⠀',
    '⠀⠀⠀⠀⠀⠀⠀⠀⣼⠀⡙⣿⣿⠰⢫⠁⣇⠀⠀⠀⠀⠀⠀⠀',
    '⠀⠀⠀⠀⠀⠀⠀⢰⣽⠱⡈⠋⠋⣤⡤⠳⠉⡆⠀⠀⠀⠀⠀⠀',
    '⠀⠀⠀⠀⠀⠀⠀⡜⠡⠊⠑⠄⣠⣿⠃⠀⣣⠃⠀⠀⠀⠀⠀⠀',
    '⠀⠀⠀⠀⠀⠐⣼⡠⠥⠊⡂⣼⢀⣤⠠⡲⢂⡌⡄⠀⠀⠀⠀⠀',
    '⠀⠀⠀⠀⣀⠝⡛⢁⡴⢉⠗⠛⢰⣶⣯⢠⠺⠀⠈⢥⠰⡀⠀⠀',
    '⠀⣠⣴⢿⣿⡟⠷⠶⣶⣵⣲⡀⣨⣿⣆⡬⠖⢛⣶⣼⡗⠈⠢⠀',
    '⢰⣹⠭⠽⢧⠅⢂⣳⠛⢿⡽⣿⢿⡿⢟⣟⡻⢾⣿⣿⡤⢴⣶⡃',
  },

  hydra = {
    '                                   ',
    '   ⣴⣶⣤⡤⠦⣤⣀⣤⠆     ⣈⣭⣿⣶⣿⣦⣼⣆          ',
    '    ⠉⠻⢿⣿⠿⣿⣿⣶⣦⠤⠄⡠⢾⣿⣿⡿⠋⠉⠉⠻⣿⣿⡛⣦       ',
    '          ⠈⢿⣿⣟⠦ ⣾⣿⣿⣷    ⠻⠿⢿⣿⣧⣄     ',
    '           ⣸⣿⣿⢧ ⢻⠻⣿⣿⣷⣄⣀⠄⠢⣀⡀⠈⠙⠿⠄    ',
    '          ⢠⣿⣿⣿⠈    ⣻⣿⣿⣿⣿⣿⣿⣿⣛⣳⣤⣀⣀   ',
    '   ⢠⣧⣶⣥⡤⢄ ⣸⣿⣿⠘  ⢀⣴⣿⣿⡿⠛⣿⣿⣧⠈⢿⠿⠟⠛⠻⠿⠄  ',
    '  ⣰⣿⣿⠛⠻⣿⣿⡦⢹⣿⣷   ⢊⣿⣿⡏  ⢸⣿⣿⡇ ⢀⣠⣄⣾⠄   ',
    ' ⣠⣿⠿⠛ ⢀⣿⣿⣷⠘⢿⣿⣦⡀ ⢸⢿⣿⣿⣄ ⣸⣿⣿⡇⣪⣿⡿⠿⣿⣷⡄  ',
    ' ⠙⠃   ⣼⣿⡟  ⠈⠻⣿⣿⣦⣌⡇⠻⣿⣿⣷⣿⣿⣿ ⣿⣿⡇ ⠛⠻⢷⣄ ',
    '      ⢻⣿⣿⣄   ⠈⠻⣿⣿⣿⣷⣿⣿⣿⣿⣿⡟ ⠫⢿⣿⡆     ',
    '       ⠻⣿⣿⣿⣿⣶⣶⣾⣿⣿⣿⣿⣿⣿⣿⣿⡟⢀⣀⣤⣾⡿⠃     ',
  }
}

local footers = {
  soulsborne = {
    { 'The brighter a flame, the deeper the shadow', '', '- Vendrick' },
    { 'Every age it seems, is tainted by the greed of men', '', '- Patches' },
    { 'Like a moth drawn to the flame, your wings will burn in anguish, time after time', '', '- Shrine Handmaid' },
    { 'Men are props on the stage of life, and no matter how tender, how exquisite... a lie will remain a lie!', '', '- Aldia' },
    { 'The world began without knowledge and without knowledge will it end' },
    { 'Seek strength... the rest will follow', '', '- Vendrick' },
    { 'What is bravery without a bit of recklessness?', '', 'Hawkeye Gough' },
    { 'For the curse of life is the curse of want. And so, you peer into the fog, in hope of answers' },
    { 'Only in truth, the Lords will abandon their thrones, and the Unkindled will rise. Nameless accursed undead, unfit even to be cinder. And so it is that ash seeketh embers' },
    { 'Fear not the dark, my friend. And let the feast begin!' },
    { 'There is no path. Beyond the scope of light, beyond the reach of Dark. What could possibly await us? And yet, we seek it, insatiably... such is our fate' },
    { 'You\'ve got a heart of gold. Don\'t let them take it from you' }
  }
}

function Personalize_alpha()
  local dashboard = require('alpha.themes.dashboard')
  local fortune   = require('alpha.fortune')

  local ascii_options  = {}
  local footer_options = {}
  for key, _ in pairs(ascii)   do table.insert(ascii_options, key)  end
  for key, _ in pairs(footers) do table.insert(footer_options, key) end

  vim.ui.select(ascii_options, { prompt = '~ascii~' }, function(ascii_choice)
    ascii_choice = ascii_choice or ''
    dashboard.section.header.val = ascii[ascii_choice] or ''
    vim.cmd('AlphaRedraw')

    vim.ui.select(footer_options, {prompt = '~footer~'}, function(footer_choice)
      if footer_choice then dashboard.section.footer.val = fortune({ fortune_list = footers[footer_choice] })
      else                  dashboard.section.footer.val = {}
      end
      vim.cmd('AlphaRedraw')

      Save_personalization({ ascii = ascii_choice, footer = footer_choice or '' })
    end)
  end)
end

local path = vim.fn.stdpath('config') .. '/alpha.json'

function Save_personalization(choices)
  vim.fn.system('touch ' .. path)
  vim.fn.writefile({ vim.json.encode({ ascii = choices.ascii, footer = choices.footer }) }, path)
end

local selected = { ascii = 'hydra', footer = nil }

if vim.fn.filereadable(path) ~= 0 then
  local cfg = vim.json.decode(vim.fn.join(vim.fn.readfile(path)))
  if cfg.ascii then selected.ascii = cfg.ascii end
  selected.footer = cfg.footer
end

return {
  'goolord/alpha-nvim',

  config = function()
    local alpha     = require('alpha')
    local dashboard = require('alpha.themes.dashboard')
    local fortune   = require('alpha.fortune')

    dashboard.section.buttons.val = {
      dashboard.button('f', '     browse',      ':Telescope find_files <CR>'),
      dashboard.button('r', '     recents',     ':Telescope oldfiles <CR>'),
      dashboard.button('e', '     new-file',    ':ene <BAR> startinsert <CR>'),
      dashboard.button('c', '     colorscheme', ':Telescope colorscheme <CR>'),
      dashboard.button('p', '     personalize', ':lua Personalize_alpha() <CR>'),
      dashboard.button('s', '     settings',    ':e $MYVIMRC <CR>'),
      dashboard.button('q', '     quit',        ':qa <CR>'),
    }

    dashboard.section.header.val = ascii[selected.ascii] or ''
    if selected.footer and selected.footer ~= '' then dashboard.section.footer.val = fortune({ fortune_list = footers[selected.footer] }) end

    alpha.setup(dashboard.opts)

    vim.api.nvim_set_keymap('n', '<leader>a', ':Alpha <CR>', {})
  end
}
